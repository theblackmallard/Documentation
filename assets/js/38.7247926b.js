(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{254:function(e,t,a){"use strict";a.r(t);var s=a(0),n=Object(s.a)({},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"advanced-series-—-antara-module-development-basics"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#advanced-series-—-antara-module-development-basics","aria-hidden":"true"}},[e._v("#")]),e._v(" Advanced Series — Antara Module Development Basics")]),e._v(" "),a("h2",{attrs:{id:"the-eval-code"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-eval-code","aria-hidden":"true"}},[e._v("#")]),e._v(" The Eval Code")]),e._v(" "),a("p",[e._v('In the Komodo source code, each Antara Module has an associated arbitrary number, called an "eval" code. This code can be any digit between '),a("code",[e._v("0")]),e._v(" and "),a("code",[e._v("255")]),e._v(", there can be only one code per module, and each code is currently one byte in size. To add a new Antara Module, the developer begins by adding a new eval code to the table of all active eval codes on their Smart Chain.")]),e._v(" "),a("p",[e._v("We define all eval codes in the "),a("a",{attrs:{href:"https://github.com/jl777/komodo/tree/jl777/src/cc/eval.h",target:"_blank",rel:"noopener noreferrer"}},[e._v("~/komodo/src/cc/eval.h"),a("OutboundLink")],1),e._v(" file. The following eval codes represent the essential, default modules in a Smart Chain.")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token macro property"}},[e._v("#"),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[e._v("define")]),e._v(" FOREACH_EVAL(EVAL)             \\\n        EVAL(EVAL_IMPORTPAYOUT, 0xe1)  \\\n        EVAL(EVAL_IMPORTCOIN,   0xe2)  \\\n        EVAL(EVAL_ASSETS,   0xe3)  \\\n        EVAL(EVAL_FAUCET, 0xe4) \\\n        EVAL(EVAL_REWARDS, 0xe5) \\\n        EVAL(EVAL_DICE, 0xe6) \\\n        EVAL(EVAL_FSM, 0xe7) \\\n        EVAL(EVAL_AUCTION, 0xe8) \\\n        EVAL(EVAL_LOTTO, 0xe9) \\\n        EVAL(EVAL_MOFN, 0xea) \\\n        EVAL(EVAL_CHANNELS, 0xeb) \\\n        EVAL(EVAL_ORACLES, 0xec) \\\n        EVAL(EVAL_PRICES, 0xed) \\\n        EVAL(EVAL_PEGS, 0xee) \\\n        EVAL(EVAL_TRIGGERS, 0xef) \\\n        EVAL(EVAL_PAYMENTS, 0xf0) \\\n        EVAL(EVAL_GATEWAYS, 0xf1)")]),e._v("\n")])])]),a("p",[e._v("As the eval code must range between "),a("code",[e._v("0")]),e._v(" and "),a("code",[e._v("255")]),e._v(", a Smart Chain can have up to 256 total modules. The developer of a Smart Chain can determine which modules to add from the available modules in the ecosystem. At this time, we do not yet have 256 total modules, and therefore there is no need to choose.")]),e._v(" "),a("h4",{attrs:{id:"validation-code"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#validation-code","aria-hidden":"true"}},[e._v("#")]),e._v(" Validation Code")]),e._v(" "),a("p",[e._v("The developer adds validation code that will be executed any time the daemon encounters a transaction bearing the relevant module's eval code.")]),e._v(" "),a("p",[e._v("This is where the true power of CC begins. When validating a normal transaction, the daemon has access only to information included in the transaction itself. With a CC transaction, however, the daemon is running arbitrary code, and therefore anything is possible. The validation code can look through the blockchain history, observe transactions in the mempool, and even utilize Antara's cross-chain technology.")]),e._v(" "),a("p",[e._v("Technically, OP_CCC scripts do not have a required structure. The scripts only need to follow the general structure of the initial layout. The developer may follow the general guideline, as provided in our templates and tutorials. This allows the developer to code and debug their OP_CCC related modules in an efficient manner.")]),e._v(" "),a("h4",{attrs:{id:"flexbile-pubkey-expression"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#flexbile-pubkey-expression","aria-hidden":"true"}},[e._v("#")]),e._v(" Flexbile Pubkey Expression")]),e._v(" "),a("p",[e._v("To understand how CryptoConditions (CC) manages addresses and scripts, the developer should first understand a few basic concepts regarding pubkeys.")]),e._v(" "),a("p",[e._v("Originally, Bitcoin pubkeys were 64 bytes, as opposed to the 33 byte pubkeys of today. The 64 byte pubkeys had a left half and a right half which were used for internal functions in the daemon. Using cryptographic methods, a developer could derive the left half of the function from the right half, and vice versa.")]),e._v(" "),a("p",[e._v("Early Bitcoin developers took advantage of the ability to derive one half of the pubkey from the other, and compressed the pubkey to a smaller size. They also instituted prefixes that informed the daemon whether the pubkey was odd, even, or large ("),a("code",[e._v("02")]),e._v(", "),a("code",[e._v("03")]),e._v(", and "),a("code",[e._v("04")]),e._v(" respectively). In the end, the developers compressed the 64 byte pubkey into a 33 byte version.")]),e._v(" "),a("p",[e._v("Today, there are multiple ways to express a pubkey. There are compressed and uncompressed versions of the pubkey, and the pubkey can also be expressed as two different base58 encoded addresses. All of these are associated with the same private key.")]),e._v(" "),a("h4",{attrs:{id:"pubkeys-and-cc-addresses"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pubkeys-and-cc-addresses","aria-hidden":"true"}},[e._v("#")]),e._v(" Pubkeys and CC Addresses")]),e._v(" "),a("p",[e._v("When working with software based on the Bitcoin protocol, a common problem a developer encounters is found in creating an address that is associated with a script. A frequent solution is to hash the script and use the hash as the address. Komodo uses this solution in the Antara CC implementation. Using this method, the CC script serves as the CC address.")]),e._v(" "),a("p",[e._v("With this in mind, the essential structure of a CC script is as follows. (The automatically generated content is handled by the daemon's internal functions and can be ignored.)")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("evalcode + pubkey + automatically generated content\n")])])]),a("p",[e._v("Each CC script utilizes the eval code of the module to which the CC script belongs. Since the CC script includes both the pubkey and the module's unique eval code, a pubkey makes a unique CC address for each module.")]),e._v(" "),a("p",[e._v("Funds that are sent to a CC address can be spent only by the module with the appropriate eval code, and therefore funds created and associated with an eval code maintain scarcity within this module.")]),e._v(" "),a("p",[e._v("A common and simple CC script exists in nearly all of the default Antara Modules. The structure of this script consists of a single signature from a pubkey and CC validation. This is essentially the equivalent of a P2PK Bitcoin script; the CC validation returns "),a("code",[e._v("true")]),e._v(" or "),a("code",[e._v("false")]),e._v(", whereas the P2PK Bitcoin script returns "),a("code",[e._v("1")]),e._v(" or "),a("code",[e._v("0")]),e._v(".")]),e._v(" "),a("h4",{attrs:{id:"global-cc-address"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#global-cc-address","aria-hidden":"true"}},[e._v("#")]),e._v(" Global CC Address")]),e._v(" "),a("p",[e._v("By convention, each Antara Module has a global CC address where the privkey is publicly available. As usual, spending from this global CC address requires that the spender meet all validation rules set forth by the developer. Therefore, the lack of privacy for the private key is not an issue.")]),e._v(" "),a("p",[e._v("One purpose for this global CC address is to create a repository that is global (within the module) for information regarding specific instances of this module on the chain.")]),e._v(" "),a("p",[e._v("For example, typically the design of an Antara Module requires that each time a user initiates an instance of the module, the user also sends a small amount of funds to this global CC address. This transaction contains data about the instance the user desires to create. Other users on the network can retrieve the data in this global CC address, and thereby gain knowledge about the current state of all module instances on the Smart Chain.")]),e._v(" "),a("h2",{attrs:{id:"vector-inputs-and-outputs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vector-inputs-and-outputs","aria-hidden":"true"}},[e._v("#")]),e._v(" Vector Inputs and Outputs")]),e._v(" "),a("p",[e._v('A transaction in the Bitcoin protocol consists of input and output vectors, called "vins" and "vouts" for brevity. The vins take funds from utxos, combine them into one "spend" transaction, and create new vouts. Some of the vouts may be new utxos.')]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("vin0 + vin1 + ... + vin[n-1] -> vout0 + vout1 + ... vout[n-1]\n")])])]),a("p",[e._v("Each of the vouts has a spend script that must be satisfied before the vout can be spent.")]),e._v(" "),a("p",[e._v("Suppose vout0 is a normal utxo with a small amount of funds and the receiver of this utxo desires to spend it. They create a new transaction with a vin that consumes vout0. This vin must satisfy any scripts that are contained in vout0.")]),e._v(" "),a("h4",{attrs:{id:"cc-enhances-the-script-between-vin-and-vout-to-advanced-levels"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cc-enhances-the-script-between-vin-and-vout-to-advanced-levels","aria-hidden":"true"}},[e._v("#")]),e._v(" CC Enhances the Script Between Vin and Vout to Advanced Levels")]),e._v(" "),a("p",[e._v("A key power of CryptoConditions (CC) is the ability to enhance the script that must be satisfied between a vin and a vout. In CC, the vout contains the logical condition, and the vin contains the logical fulfillment.")]),e._v(" "),a("p",[e._v('With access to arbitrary code, CC allows the Bitcoin protocol to rival the "smart contracts" common on other platforms. Yet, CC accomplishes this without requiring the virtual-machine counterpart that other smart-contract platforms require. Instead, the consensus mechanism is directly engaged with the scripts in the vins and vouts of transactions.')]),e._v(" "),a("p",[e._v("The Bitcoin protocol's consensus mechanism is constantly placed under the most intense of pressure in the industry, and therefore is likely the most reliable consensus mechanism available. The ability to engage the consensus mechanism in arbitrary code while not changing the consensus mechanism itself grants Antara security and stability. The utxo system of the Bitcoin protocol also reduces the likelihood that modules themselves will contain bugs internally. (The reader should note that CC cannot eliminate attack vectors altogether.)")]),e._v(" "),a("h4",{attrs:{id:"the-many-possibilities-of-oc-checkcryptocondition"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-many-possibilities-of-oc-checkcryptocondition","aria-hidden":"true"}},[e._v("#")]),e._v(" The Many Possibilities of OC_CHECKCRYPTOCONDITION")]),e._v(" "),a("p",[e._v("Consider the implications of the combination of possibilities contained in this new opreturn, OP_CCC. As there can be up to 256 eval codes per Smart Chain, there can be up to 256 different types of CC outputs per chain. Each CC transaction can contain multiple vins and vouts, each of which provides CC related fulfillments and conditions. Also, each module has a globally available CC address to allow for chain-wide functionality, making the possibilities per vin or vout 257.")]),e._v(" "),a("p",[e._v("Observe the essential structure of a transaction with 3 vins and 2 vouts.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("vin0 + vin1 + vin2 -> vout0 + vout1\n")])])]),a("p",[e._v("With the possibilities of OP_CCC, the combination allows for 1.12e+12 possibile combinations.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("257 * 257 * 257 * 257 * 257 = 1.12e+12\n")])])]),a("p",[e._v("This is a dramatic increase in the possibilities over the limits of the original Bitcoin protocol.")]),e._v(" "),a("p",[e._v("While the possibilities of a transaction are essentially limitless, the developer must create validation code that ensures the module and its transactions function as intended. Therefore, in practice the developer often limits the possibilities to "),a("code",[e._v("1")]),e._v(" to "),a("code",[e._v("3")]),e._v(" types per vin or vout.")]),e._v(" "),a("h2",{attrs:{id:"introduction-to-the-remote-procedure-call-rpc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#introduction-to-the-remote-procedure-call-rpc","aria-hidden":"true"}},[e._v("#")]),e._v(" Introduction to the Remote Procedure Call (RPC)")]),e._v(" "),a("p",[e._v("A Remote Procedure Call (RPC) allows a module developer the ability to offer easy access to their module's functionality. The role of the RPC calls are to create properly signed raw transactions that are ready for broadcasting.")]),e._v(" "),a("p",[e._v("The developer places the command name of each RPC they desire to create into a table in the CC source code. From this table, the built-in komodo-cli software is able to access and execute the RPC. In this manner, developers of all skills levels can integrate Antara Modules into other software.")]),e._v(" "),a("p",[e._v("Antara Modules can have any RPCs the developer desires, or even have no RPCs. By convention, each Antara Modules has a few default RPCs: "),a("code",[e._v("<CC_Name>address")]),e._v(", "),a("code",[e._v("<CC_name>list")]),e._v(", and "),a("code",[e._v("<CC_name>info")]),e._v(". For example, the Dice module has, "),a("code",[e._v("diceaddress")]),e._v(", "),a("code",[e._v("dicelist")]),e._v(", and "),a("code",[e._v("diceinfo")]),e._v(". Respectively, these RPCs return information about a CC-related address, the list of all instances of this module on the Smart Chain, and information about the chain-wide state of the module.")]),e._v(" "),a("h2",{attrs:{id:"creating-a-global-cc-address"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#creating-a-global-cc-address","aria-hidden":"true"}},[e._v("#")]),e._v(" Creating a Global CC Address")]),e._v(" "),a("p",[e._v("The following code from the Faucet module serves as an example of the manner in which we begin the creation of a global CC address for this module.")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v("FaucetCCaddr "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"R9zHrofhRbub7ER77B7NrVch3A63R39GuC"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v("FaucetNormaladdr "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"RKQV4oYs4rvxAWx1J43VnT73rSTVtUeckk"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),e._v(" FaucetCChexstr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("67")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"03682b255c40d0cde8faee381a1a50bbb89980ff24539cb8518e294d3a63cefe12"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nuint8_t FaucetCCpriv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("32")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0xd4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0x4f")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0xf2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0x31")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0x71")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0x7d")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0x28")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0x02")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0x4b")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0xc7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0xdd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0x71")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0xa0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0x39")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0xc4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0xbe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0x1a")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0xfe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0xeb")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0xc2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0x46")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0xda")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0x76")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0xf8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0x07")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0x53")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0x3d")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0x96")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0xb4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0xca")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0xa0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0xe9")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("For a template of this logic pattern, view the "),a("a",{attrs:{href:"https://github.com/jl777/komodo/tree/jl777/src/cc/CCcustom.cpp",target:"_blank",rel:"noopener noreferrer"}},[e._v("CCcustom.cpp"),a("OutboundLink")],1),e._v(" file.")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/jl777/komodo/tree/jl777/src/cc/CCcustom.cpp",target:"_blank",rel:"noopener noreferrer"}},[a("b",[e._v("Link to CCcustom.cpp file")]),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("Note that at the bottom of the file there is a switch statement. There, the above values are copied into an in-memory data structure for each CC type. This allows the entire CC codebase to access the global CC addresses in a standard manner.")]),e._v(" "),a("p",[e._v("To create a global CC address for a new module, follow these steps.")]),e._v(" "),a("h4",{attrs:{id:"create-a-value-using-getnewaddress"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-a-value-using-getnewaddress","aria-hidden":"true"}},[e._v("#")]),e._v(" Create a value using getnewaddress")]),e._v(" "),a("p",[e._v("With the "),a("code",[e._v("komodod")]),e._v(" daemon running, use the "),a("router-link",{attrs:{to:"/basic-docs/smart-chains/smart-chain-api/wallet.html#getnewaddress"}},[a("b",[e._v("getnewaddress")])]),e._v(" RPC with "),a("code",[e._v("komodo-cli")]),e._v(" to get a new address. (You may use any Komodo Smart Chain, such as the KMD main chain, for this procedure.)")],1),e._v(" "),a("p",[e._v("Copy this value into the first line of the code. For example, in the Faucet code above the result is as follows.")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v("FaucetNormaladdr "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"RKQV4oYs4rvxAWx1J43VnT73rSTVtUeckk"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("h4",{attrs:{id:"retrieve-the-pubkey-using-validateaddress"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#retrieve-the-pubkey-using-validateaddress","aria-hidden":"true"}},[e._v("#")]),e._v(" Retrieve the pubkey using validateaddress")]),e._v(" "),a("p",[e._v("Use the "),a("router-link",{attrs:{to:"/basic-docs/smart-chains/smart-chain-api/util.html#validateaddress"}},[a("b",[e._v("validateaddress")])]),e._v(" RPC with "),a("code",[e._v("komodo-cli")]),e._v(" to obtain the pubkey of the new normal address from the previous step.")],1),e._v(" "),a("p",[e._v("Place the returned value into the "),a("code",[e._v("<CChexstr>[67]")]),e._v(" line of code.")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),e._v(" FaucetCChexstr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("67")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"03682b255c40d0cde8faee381a1a50bbb89980ff24539cb8518e294d3a63cefe12"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("h4",{attrs:{id:"restart-the-daemon-with-the-pubkey"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#restart-the-daemon-with-the-pubkey","aria-hidden":"true"}},[e._v("#")]),e._v(" Restart the Daemon with the pubkey")]),e._v(" "),a("p",[e._v("Stop the daemon and restart with the "),a("router-link",{attrs:{to:"/basic-docs/smart-chains/smart-chain-setup/common-runtime-parameters.html#pubkey"}},[a("b",[e._v("pubkey")])]),e._v(" launch parameter enabled. Use the pubkey from the "),a("b",[e._v("validateaddress")]),e._v(" RPC as the pubkey value.")],1),e._v(" "),a("h4",{attrs:{id:"ensure-the-myprivkey-function-is-properly-enabled"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ensure-the-myprivkey-function-is-properly-enabled","aria-hidden":"true"}},[e._v("#")]),e._v(" Ensure the Myprivkey Function is Properly Enabled")]),e._v(" "),a("p",[e._v("Check that the "),a("code",[e._v("if ( 0 )")]),e._v(" statement is enabled in the  "),a("code",[e._v("Myprivkey()")]),e._v(" function in the "),a("code",[e._v("/src/cc/CCutils.cpp")]),e._v(" file.")]),e._v(" "),a("h4",{attrs:{id:"add-the-first-rpc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#add-the-first-rpc","aria-hidden":"true"}},[e._v("#")]),e._v(" Add the First RPC")]),e._v(" "),a("p",[e._v("Add a line to the "),a("code",[e._v("/src/server.h")]),e._v(" file to create the "),a("code",[e._v("<CC_name>address")]),e._v(" function for the module.")]),e._v(" "),a("p",[e._v("Update the commands array in the "),a("code",[e._v("/src/server.cpp")]),e._v(" file.")]),e._v(" "),a("p",[e._v("Add the code for "),a("code",[e._v("<CC_name>address")]),e._v(" into the "),a("code",[e._v("/src/wallet/rpcwallet.cpp")]),e._v(" source file:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("UniValue "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("CC_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("address")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" UniValue"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v(" params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" bool fHelp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("struct")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("CCcontract_info")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v("cp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("C"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" std"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("::")]),e._v("vector"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("unsigned")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" pubkey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    cp "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("CCinit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("C"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("EVAL_"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("YOUR"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("EVAL"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("NAME"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v(" fHelp "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("||")]),e._v(" params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n        throw "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("runtime_error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"<CC_name>address [pubkey]\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("ensure_CCrequirements")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n        throw "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("runtime_error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("CC_REQUIREMENTS_MSG"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v(" params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("==")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n        pubkey "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("ParseHex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("get_str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("c_str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("CCaddress")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("cp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"<CC_name>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("pubkey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("Replace "),a("code",[e._v("<YOUR-EVAL-NAME>")]),e._v(" with your eval code name. For example, "),a("code",[e._v("EVAL_FAUCET")]),e._v(" or "),a("code",[e._v("EVAL_ASSETS")]),e._v(".")]),e._v(" "),a("p",[e._v("Replace "),a("code",[e._v("<CC_name>")]),e._v(" with your module name. For example, "),a("code",[e._v("faucetaddress")]),e._v(".")]),e._v(" "),a("h4",{attrs:{id:"obtain-the-ccaddress"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#obtain-the-ccaddress","aria-hidden":"true"}},[e._v("#")]),e._v(" Obtain the CCaddress")]),e._v(" "),a("p",[e._v("Execute the "),a("code",[e._v("<CC_name>address")]),e._v(" RPC call and use the returned value to complete the "),a("code",[e._v("<CC_Name>CCaddr")]),e._v(" line of code.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('const char *FaucetCCaddr = "R9zHrofhRbub7ER77B7NrVch3A63R39GuC";\n')])])]),a("h4",{attrs:{id:"obtain-the-privkey-in-hex-format"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#obtain-the-privkey-in-hex-format","aria-hidden":"true"}},[e._v("#")]),e._v(" Obtain the privkey in Hex Format")]),e._v(" "),a("p",[e._v("From the response returned by the "),a("code",[e._v("<CC_name>address")]),e._v(" RPC, use the hex value of the private key to complete the appropriate line of code.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("uint8_t FaucetCCpriv[32] = { 0xd4, 0x4f, 0xf2, 0x31, 0x71, 0x7d, 0x28, 0x02, 0x4b, 0xc7, 0xdd, 0x71, 0xa0, 0x39, 0xc4, 0xbe, 0x1a, 0xfe, 0xeb, 0xc2, 0x46, 0xda, 0x76, 0xf8, 0x07, 0x53, 0x3d, 0x96, 0xb4, 0xca, 0xa0, 0xe9 };\n")])])]),a("p",[e._v("Stop the daemon and restart it using the new pubkey.")]),e._v(" "),a("h4",{attrs:{id:"copy-the-existing-default-rpcs-to-the-new-module"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#copy-the-existing-default-rpcs-to-the-new-module","aria-hidden":"true"}},[e._v("#")]),e._v(" Copy the Existing Default RPCs to the New Module")]),e._v(" "),a("p",[e._v("From the "),a("code",[e._v("/src/wallet/rpcwallet.cpp")]),e._v(" file, copy and paste the existing RPC functions to create new versions for the new module. Change the eval code and customize the functions as desired.")]),e._v(" "),a("p",[e._v("Add an entry into the "),a("code",[e._v("/src/cc/eval.h")]),e._v(" file.")]),e._v(" "),a("h2",{attrs:{id:"introduction-to-validation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#introduction-to-validation","aria-hidden":"true"}},[e._v("#")]),e._v(" Introduction to Validation")]),e._v(" "),a("p",[e._v("A large portion of Antara Module customization pertains to the manner in which the validation code constrains CC transaction input.")]),e._v(" "),a("p",[e._v("The CC validation code is called at the time that the consensus mechanism is validating a CC transaction. The consensus mechanism only calls the CC validation code and waits for a response of "),a("code",[e._v("true")]),e._v(" or "),a("code",[e._v("false")]),e._v(". Whether or not the CC validation code is effective is a matter for the developer to resolve.")]),e._v(" "),a("p",[e._v("The developer is responsible for properly designing both the validation code and the RPC implementations. Both should work together to ensure that RPCs cannot create transactions that should not exist, and the CC validation code should only validate proper transactions.")]),e._v(" "),a("p",[e._v("The CC validation code is already locked in the main loop of the Bitcoin protocol at the time the code is called. Care should be taken with the CC validation code to ensure that the code does not cause a deadlock on the chain.")]),e._v(" "),a("hr"),e._v(" "),a("p",[a("router-link",{attrs:{to:"/basic-docs/antara/antara-tutorials/advanced-series-3.html"}},[a("b",[e._v("Link to Next Tutorial in Advanced Series")])])],1)])},[],!1,null,null,null);t.default=n.exports}}]);